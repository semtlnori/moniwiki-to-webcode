#title 참조 무결성 분석 작업
[[TableOfContents]]
 
== 배경 ==
 * nFORGE의 각 테이블에는 외래키를 활용한 참조 무결성 제약 조건을 이런 저런 이유로 사용하지 않고(DBMS간 호환성, 성능 기타의 이유...) 각 기능별로 참조하는 테이블을 적절히 삭제하여 외래키의 DELETE CASCADE를 대치했습니다. 그리고, 혹시 응용에서 삭제 처리를 처리하지 못해서 참조 무결성을 위반하는 사례가 있는 경우는 sh cronjobs/db_check_constraint.sh를 통해서 해당하는 내역이 있는지 추출하여 응용 수정 및 자료 정비(DELETE)에 사용할 수 있도록 했습니다
 * nFORGE 전체 스키마에 대해서 누락한 무결성 검사 조건은 없는지, 테이블간의 의존성과 연관도는 어떻게 되는지 등의 정보를 추출할 필요가 있다.
 * 관련 이슈 #1985

== 분석 결과물 ==
 * 참조 무결성 기반 정보 배열
  주테이블:주키컬럼-참조테이블:참조컬럼의 내용을 담은 배열로 참조 무결성을 확인할 수 있는 정보이다
 * 테이블간 의존성 그래프
  주테이블-참조테이블 간의 의존성을 기반으로 참조 무결성 기반 정보 배열을 의존성 순서로 배열한다

== 분석 방법 ==
 * nFORGE 모든 폴더에서 *.xml 파일을 일괄 검색
 * 주키 설정여부, 동일 타입, 사전 설정 정보를 기반으로 참조 무결성 기반 정보 배열 작성
 * 테이블간 의존성을 기반으로 테이블간 의존성 그래프 작성

== 분석 도구 ==
 * cronjobs/analyze_db_schema.php
 * analyze_db_schema.php를 수행시키면 nforge_schema.dot를 생성하는데 이를 아래와 같은 명령으로 의존성 그래프를 작성할 수 있다
 {{{ dot  -Gsize="70,30" -Gratio="fill" -Tpng nforge_schema.dot -o nforge_schema.png 
}}}
 * 수정한 참조 무결성 기반 정보 배열은 db_check_constraint_status.php에 반영한다.
